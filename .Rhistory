rename(
emp_agforest = naics11,
emp_mining = naics21,
emp_util = naics22,
emp_const = naics23,
emp+manuf = `naics31-33`,
emp_wholesale = naics42,
emp_retail = `naics44-45`,
emp_transport = `naics48-49`,
emp_info = naics51,
emp_finance = naics52,
emp_realestate = naics53,
emp_profsci = naics54,
emp_mgmn = naics55,
emp_admin = naics56,
emp_educ = naics61,
emp_health = naics62,
emp_arts = naics71,
emp_food = naics72,
emp_other = naics81,
emp_gov = naics92
)
# Update to better names
df_census_summs <-
df_census_summs %>%
rename(
emp_agforest = naics11,
emp_mining = naics21,
emp_util = naics22,
emp_const = naics23,
emp_manuf = `naics31-33`,
emp_wholesale = naics42,
emp_retail = `naics44-45`,
emp_transport = `naics48-49`,
emp_info = naics51,
emp_finance = naics52,
emp_realestate = naics53,
emp_profsci = naics54,
emp_mgmn = naics55,
emp_admin = naics56,
emp_educ = naics61,
emp_health = naics62,
emp_arts = naics71,
emp_food = naics72,
emp_other = naics81,
emp_gov = naics92
)
# Full join
df_census <-
get_census(
years = c(2001:2005, 2007:2015),
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81,92),
fips = list_fips_state
)
df_census_summs <-
df_census %>%
group_by(fips, year) %>%
mutate(
totpayann = sum(payann),
totemp = sum(emp),
totestab = sum(estab),
naics = case_when(
naics_ttl == "Manufacturing" ~ "31-33",
naics_ttl %in% c("Transportation and warehousing", "Transportation & warehousing", "Transportation and Warehousing") ~ "48-49",
naics_ttl %in% c("Retail trade", "Retail Trade") ~ "44-45",
TRUE ~ naics
)
) %>%
ungroup() %>%
mutate(
proppayann = payann / totpayann,
propemp = emp / totemp,
propestab = estab / totestab
)
# Wide summs df
(df_census_summs <-
df_census_summs %>%
select(
-c(totpayann, totemp, totestab, emp, estab, payann, proppayann, propestab, state, county, geo_ttl, naics_ttl)
) %>%
pivot_wider(
id_cols = c(year, fips),
names_from = naics,
values_from = propemp,
names_prefix = "naics"
))
# Update to better names
df_census_summs <-
df_census_summs %>%
rename(
emp_agforest = naics11,
emp_mining = naics21,
emp_util = naics22,
emp_const = naics23,
emp_manuf = `naics31-33`,
emp_wholesale = naics42,
emp_retail = `naics44-45`,
emp_transport = `naics48-49`,
emp_info = naics51,
emp_finance = naics52,
emp_realestate = naics53,
emp_profsci = naics54,
emp_mgmn = naics55,
emp_admin = naics56,
emp_educ = naics61,
emp_health = naics62,
emp_arts = naics71,
emp_food = naics72,
emp_other = naics81
)
df_culv <-
df_culv %>%
filter(
# project_year %in% c(2010:2012),
# state == "WA"
) %>%
left_join(
df_census_summs,
by = c(
"completed_year" = "year",
"fips" = "fips"
)
)
df_culv %>% select(starts_with("naics")) %>% summary()
df_culv %>% select(starts_with("emp_")) %>% summary()
df_culv %>% select(fips, starts_with("emp_")) %>% summary()
df_culv %>% select(fips, starts_with("emp_")) %>% mutate(accross(everything(), ~is.na(.))) %>% summary()
df_culv %>% select(fips, starts_with("emp_")) %>% mutate(across(everything(), ~is.na(.))) %>% summary()
df_culv %>% select(fips, starts_with("emp_")) %>% mutate(across(everything(), ~is.na(.))) %>% tabyl(emp_agforest, completed_year)
df_culv %>% select(fips, completed_year, starts_with("emp_")) %>% mutate(across(everything(-completed_year), ~is.na(.))) %>% tabyl(emp_agforest, completed_year)
df_culv %>% select(fips, completed_year, starts_with("emp_")) %>% mutate(across(-completed_year, ~is.na(.))) %>% tabyl(emp_agforest, completed_year)
# Save out
write_csv(df_culv, here("output/culverts_full_working.csv"))
df_culv %>% select(fips, completed_year, starts_with("emp_")) %>% mutate(across(-completed_year, ~is.na(.))) %>% tabyl(emp_agforest, completed_year)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23, 11
),
fips = 53
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = 53
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = 5
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = 6
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = 06
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = `06`
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = "06"
)
df_census_test
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23
),
fips = "23"
)
df_census_test <-
get_census(
years = c(2001:2015),
naics = c(
23,11
),
fips = "41"
)
# Full join
df_census <-
get_census(
years = c(2001:2005, 2007:2015),
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state %>% as.character()
)
# Full join
df_census <-
get_census(
years = c(2001:2015),
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state %>% as.character()
)
# Full join
df_census <-
get_census(
years = c(2006),
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state %>% as.character()
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state[5] %>% as.character()
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state[2] %>% as.character()
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = list_fips_state[3] %>% as.character()
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(11,21,22,23,"31-33",42,"44-45","48-49",51,52,53,54,55,56,61,62,71,72,81),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
11,
21,
22,
23,
"31-33",
42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
21,
22,
23,
"31-33",
42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
21,
22,
# 23,
"31-33",
42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
21,
# 22,
# 23,
"31-33",
42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
21,
# 22,
# 23,
"31-33",
# 42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
# 21,
# 22,
# 23,
"31-33",
# 42,
"44-45",
"48-49",
51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
# 21,
# 22,
# 23,
"31-33",
# 42,
"44-45",
"48-49",
# 51,
52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
# 21,
# 22,
# 23,
"31-33",
# 42,
"44-45",
"48-49",
# 51,
# 52,
53,
54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
# Weird problem with 2006 rn
# Also clearly a problem only for certain naics codes/states b/c the tests with only forestry and construction worked fine
df_census <-
get_census(
years = 2006,
naics = c(
# 11,
# 21,
# 22,
# 23,
"31-33",
# 42,
"44-45",
"48-49",
# 51,
# 52,
53,
# 54,
55,
56,
61,
62,
71,
72,
81
),
fips = "06"
)
