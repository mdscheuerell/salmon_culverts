sec.axis = dup_axis(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent())) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
x.sec = guide_axis(position = "bottom", order = 1, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme(
axis.text.y = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_text(size = 12, face = "bold"),
axis.title = element_blank(),
panel.grid.minor.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "vertical",
legend.background = element_blank(),
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
facet_grid(rows = "species2", switch = "y", scales = "free_y", space = "free_y") +
coord_flip() +
ggtitle("Land cover in habitat range for listed salmonid DPS")
?scale_y_continuous
# Broad Categories All Species
df_crdcount_summ_long %>%
filter(status != "Not Warranted") %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
geom_point(aes(x = esu_dps, y = -0.05, color = status), fill = NA, size = 7, shape = "square", position = "identity") +
geom_text(aes(x = esu_dps, y = 1.25, label = domain), vjust = 0.5, size = 3.5, fontface = "plain") +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = "Land Cover"
) +
scale_color_manual(
limits = c("Not Warranted", "Species of Concern", "Threatened", "Endangered"),
values = c("green", "yellow", "darkorange", "red"),
name = "Status"
) +
scale_y_continuous(breaks = c(-0.05, 0.5, 1.25), labels = c("Status", "Land Use", "Domain"), limits = c(-0.05, 1.4),
minor_breaks = c(0, 0.25, 0.5, 0.75, 1),
sec.axis = dup_axis(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent())) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
x.sec = guide_axis(position = "bottom", order = 1, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme(
axis.text.y = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_text(size = 12, face = "bold"),
axis.title = element_blank(),
panel.grid.minor.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "vertical",
legend.background = element_blank(),
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
facet_grid(rows = "species2", switch = "y", scales = "free_y", space = "free_y") +
coord_flip() +
ggtitle("Land cover in habitat range for listed salmonid DPS")
i = dps[5]
states_core <- st_as_sf(maps::map("state", regions = c("california", "oregon", "washington", "idaho"), plot = FALSE, fill = TRUE)) %>% st_transform(st_crs(sf_recoverydomain))
states_expand <- st_as_sf(maps::map("state", regions = c("california", "oregon", "washington", "idaho", "montana", "wyoming", "arizona", "nevada", "utah", "colorado", "new mexico"), plot = FALSE, fill = TRUE)) %>% st_transform(st_crs(sf_recoverydomain))
land <- st_as_sf(maps::map("world", regions = c("Canada", "Mexico"), plot = FALSE, fill = TRUE)) %>% st_transform(st_crs(sf_recoverydomain))
dps <- df_crdcount %>% distinct(esu_dps) %>% arrange(esu_dps) %>% pull(esu_dps)
i = dps[5]
for(i in dps) {
cat("  \n###", i)
cat("  \n**Status:**", df_crdcount %>% filter(esu_dps == i) %>% pull(status))
cat("  \n**Domain:**", df_crdcount %>% filter(esu_dps == i) %>% pull(domain))
cat("  \n")
# Range
p_range <-
ggplot() +
geom_sf(data = land, fill = "antiquewhite1") +
geom_sf(data = states_expand, fill = "antiquewhite1") +
geom_sf(data = sf_recoverydomain %>% filter(esu_dps == i), fill = NA, color = "red") +
coord_sf(
xlim = st_bbox(states_core)[c(1,3)],
ylim = st_bbox(states_core)[c(2,4)]
) +
theme_void() +
theme(
panel.background = element_rect(fill = "aliceblue", color = NA)
)
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(minor_breaks = c(0, 0.25, 0.5, 0.75, 1),
sec.axis = dup_axis(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent())) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
x.sec = guide_axis(position = "bottom", order = 1, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.minor.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
# p_row <- plot_grid(p_range, p_cover, rel_heights = c(0.8, 0.2))
# Titles
p_title <-
ggdraw() +
draw_label(
"Habitat range and land cover share",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
p_subtitle <-
ggdraw() +
draw_label(
i,
fontface = 'bold',
size = 12,
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
# Plot it all
cat("  \n#### Habitat range and land cover")
cat("  \n")
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# List
df_crdcount_long %>%
filter(esu_dps == i) %>%
select(v, v_pct) %>%
arrange(-v_pct) %>%
filter(v_pct >= 0.01) %>%
mutate(
v = make_clean_names(v, "sentence"),
v_pct = scales::percent(v_pct, accuracy = 0.1)
) %>%
rename(
"Land cover" = v,
"%" = v_pct
) %>%
# mutate("All other" = )
kable() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), fixed_thead = T, full_width = F, position = "float_right") %>%
# scroll_box(height = "200px") %>%
footnote("All other land covers < 1%") %>%
print
cat("  \n")
}
i = dps[5]
cat("  \n###", i)
cat("  \n**Status:**", df_crdcount %>% filter(esu_dps == i) %>% pull(status))
cat("  \n**Domain:**", df_crdcount %>% filter(esu_dps == i) %>% pull(domain))
cat("  \n")
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(minor_breaks = c(0, 0.25, 0.5, 0.75, 1),
sec.axis = dup_axis(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent())) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
x.sec = guide_axis(position = "bottom", order = 1, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.minor.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
p_cover
p_cover
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent()) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.major.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
# p_row <- plot_grid(p_range, p_cover, rel_heights = c(0.8, 0.2))
# Titles
p_title <-
ggdraw() +
draw_label(
"Habitat range and land cover share",
fontface = 'bold',
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
p_subtitle <-
ggdraw() +
draw_label(
i,
fontface = 'bold',
size = 12,
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent()) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
axis.ticks = element_blank(),
# axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.major.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent()) +
guides(
x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
y = guide_axis(position = "left")
) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
# axis.ticks = element_blank(),
# axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.major.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent()) +
# guides(
#   x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
#   y = guide_axis(position = "left")
# ) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
# axis.ticks = element_blank(),
# axis.text = element_blank(),
axis.title = element_blank(),
panel.grid.major.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# Land cover bar plot
p_cover <-
df_crdcount_summ_long %>%
filter(esu_dps == i) %>%
ggplot() +
geom_col(aes(x = esu_dps, y = v_summ_pct, fill = v), position = "stack", width = 0.75) +
scale_fill_manual(
limits = c("ag_nopasture", "pasture", "shrubland", "forest", "developed", "other"),
labels = c("Cropland", "Pasture", "Shrubland", "Forest", "Developed", "Other"),
values = c("darkgoldenrod", "goldenrod", "palegreen", "darkgreen", "darkgrey", "lightgrey"),
name = ""
) +
scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), labels = scales::label_percent()) +
# guides(
#   x = guide_axis(position = "top", order = 0, check.overlap = TRUE),
#   y = guide_axis(position = "left")
# ) +
theme_void() +
theme(
# axis.text.x = element_text(hjust = 1, vjust = 0.5),
panel.spacing = unit(0.1, "lines"),
axis.line = element_blank(),
# axis.ticks = element_blank(),
axis.text.x = element_text(),
axis.title = element_blank(),
panel.grid.major.x = element_line(linetype = "dashed", color = "black"),
legend.position = "bottom",
legend.box = "horizontal",
legend.background = element_blank(),
plot.title.position = "plot",
# panel.background = element_rect(color = "black"),
strip.background = element_rect(fill = "lightgrey"),
strip.placement = "outside"
) +
coord_flip() +
ggtitle("Land Cover Share")
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
# Range
p_range <-
ggplot() +
geom_sf(data = land, fill = "antiquewhite1") +
geom_sf(data = states_expand, fill = "antiquewhite1") +
geom_sf(data = sf_recoverydomain %>% filter(esu_dps == i), fill = NA, color = "red") +
coord_sf(
xlim = st_bbox(states_core)[c(1,3)],
ylim = st_bbox(states_core)[c(2,4)]
) +
theme_void() +
theme(
panel.background = element_rect(fill = "aliceblue", color = NA)
)
plot_grid(
p_range, p_cover,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.7, 0.15)
) %>%
print
wd <- "D:/Braeden/OneDrive/Documents/My Work/NOAA/Analysis"
setwd("./output") # For Braeden; comment out for other users
# Set top-level working directory
# wd <- "C:/Users/Braeden/Desktop/NOAA/Analysis"
# wd <- "C:/Users/braeden.vandeynze/Documents/Salmon Cost Project/Analysis/"  # For Braeden; comment out for other users
wd <- "D:/Braeden/OneDrive/Documents/My Work/NOAA/Analysis"
setwd(wd)
# Load and prepare culvert data ====
setwd("./output") # For Braeden; comment out for other users
